% !TeX spellcheck = ru_RU
% !TEX root = vkr.tex

\section{Реализация}
Грамматики декларативных языков Myfile и Configfile описаны в формате EBNF. Далее по .grm файлам\footnote{\href{https://github.com/embox/embox/blob/master/mk/mybuild/myfile.grm}{https://github.com/embox/embox/blob/master/mk/mybuild/myfile.grm} (дата обращения: 08.01.2024)} GOLD генерирует необходимый парсер.
\begin{lstlisting}[caption=Пример описания грамматики, frame=single, breaklines]
<ModuleMembers>
        ::= <AnnotatedModuleMember> <ModuleMembers>
         |
<AnnotatedModuleMember>
        ::= <Annotations> <ModuleMember>
<ModuleMember>
        ::= 'depends'  <ReferenceList>
         |  'provides' <ReferenceList>
         |  'requires' <ReferenceList>
         |  'source'   <FilenameList>
         |  'object'   <FilenameList>
         |  'option'   <Option>
\end{lstlisting}
\subsection{Проектирование АСТ}
Для создания своей реализации парсера необходимо в первую очередь спроектировать структуру данных для АСТ (абстрактного дерева синтаксиса). Для этого использовались алгебраические типы данных \\ OCaml, а также библиотека deriving, для облегчения печати дерева. Во время проектирования необходимо было избавляться от некоторых избыточных правил, а также нужно было переименовать названия нетерминалов для лучшей читабельности.
\begin{lstlisting}[caption=Пример структуры данных из \href{https://github.com/mikhaylovilya/caravan/blob/master/src/parser/ast.mli\#L43C1-L53C40}{ast.mli} , language=caml, frame=single, breaklines]
type module_member =
  | Depends of composite_names
  | Provides of composite_names
  | Requires of composite_names
  | Source of file_names
  | Object of file_names
  | Opt of definition
[@@deriving show { with_path = false }]

type module_members = (annotations  * module_member) list
\end{lstlisting}
\subsection{Лексический и синтаксический анализ}
Menhir и ocamllex были использованы для синтаксического и лексического анализа соответственно. Используемые наборы символов были взяты из myfile.grm файла и перенесены в описание лексера. Для токенизации строк и игнорирования комментариев были использованы рекурсивные лексеры. Правила из myfile.grm файла переносились в описание парсера.

\begin{lstlisting}[caption=Пример описания правил в \href{https://github.com/mikhaylovilya/caravan/blob/master/src/parser/parser.mly\#L126C1-L134C61}{parser.mly}, language=caml, frame=single, breaklines]
annotated_module_member:
  | annotations = annotation*; module_member = module_member { annotations, module_member };
module_member:
  | DEPENDS_KW; references = references { Depends references }
  | PROVIDES_KW; references = references { Provides references }
  | REQUIRES_KW; references = references { Requires references }
  | SOURCE_KW; filenames = filenames { Source filenames }
  | OBJECT_KW; filenames = filenames { Object filenames }
  | OPTION_KW; definition = definition { Opt definition };
\end{lstlisting}

\subsection{Результат работы программы}
Результат работы парсера на одном из файлов Mybuild.

\begin{lstlisting}[language=caml, frame=single, breaklines]
  $\mbox{\$}$ ./_build/default/src/parser/parse.exe ../embox/src/mem/misc/Mybuild
  ((Some ["embox"; "mem"]), [],
   [([],
     (Module
        ([], "slab", None,
         [([], (Opt (NumberType, "heap_size", (Some (NumberLiteral 524288.)))));
           ([], (Source ["slab.c"; "slab_impl.h"]));
           ([], (Depends [["embox"; "mem"; "page_api"]]));
           ([], (Depends [["embox"; "mem"; "phymem"]]));
           ([], (Depends [["embox"; "mem"; "heap_place"]]))])));
     ([(["DefaultImpl"], (Some (Value (Refer ["pool_ndebug"]))))],
      (Module ([Abstract], "pool", None, [])));
     ([],
      (Module
         ([], "pool_ndebug", (Some ["pool"]),
          [([], (Source ["pool.c"]));
            ([], (Depends [["embox"; "util"; "SList"]]))])));
     ([],
      (Module
         ([], "pool_debug", (Some ["pool"]),
          [([], (Source ["pool_debug.c"])); ([], (Source ["pool_debug.h"]));
            ([], (Depends [["embox"; "util"; "SList"]]));
            ([], (Depends [["embox"; "util"; "Bitmap"]]))])))
     ])
\end{lstlisting}
% \subsection{Синтаксический анализ}
% В качестве инструмента для синтаксического анализа был использован Menhir.
% Очень важный раздел для будущих программных инженеров, т.е. почти для всех. Важно иметь всегда, в том числе для промежуточных отчетов по учебным практикам или ВКР.

% В процессе работы можно сделать огромное количество косяков, неполный список которых ниже.

% \begin{enumerate}
%   \item Реализация должна быть. На публично доступную реализацию обязательная ссылка. Если код под \textsc{NDA}, то об этом,
%   во-первых, должно быть сказано явно,
%   во-вторых, на защиту должны выно\-ситься другие результаты (например, архитектура), чтобы комис\-сия имела возможность оценить хоть что-то,
%   и, в третьих, должна быть справка от работодателя, что вы правда что-то сделали.
%         \begin{itemize}
%           \item  Рецензент обязан оценить код (о возможности должен побеспо\-коиться обучающийся).
%         \end{itemize}
%   \item Код реализации должен быть написан защищающимся целиком.
%         \begin{itemize}
%           \item  Если проект групповой, то нужно явно выделить какие части были модифицированы защищающимся. Например, в преды\-дущих разделах на картинке архитектуры нужно выделить цветом то, что вы модифицировали.
%           \item Нельзя пускать в негрупповой проект коммиты от других людей, или людей не похожих на Вас. Например, в 2022 году защищающийся-парень делал коммиты от сценического псев\-донима, который намекает на женский \enquote{гендер}. (Нет, это не шутка.) На тот момент в российской культуре это выглядело странно.
%           \item Возможна ситуация, что вы используете конкретный ник в интернете уже лет пять, и желаете писать ВКР под этим ником на \GitHub{}. В принципе, это допустимо (не только лишь я так считаю), но если Вы встретите преподавателя, который считает наоборот, то Вам придется грамотно отмазы\-ваться. В Вашу пользу могут сыграть те факты, что к нику на гитхабе у Вас приписаны настоящие имя и фамилия; что в репозитории у вас видна домашка за первый курс; и что Ваш преподаватель практики сможет подтвердить, что Вы уже несколько лет используете это ник; и т.п.
%         \end{itemize}
%   \item Если вы получаете диплом о присвоении звания программного инженера, код должен соответствовать.
%         \begin{enumerate}
%           \item Не стоит выкладывать код одним коммитом.
%           \item Не стоит выкладывать код аккурат перед защитой.
%           \item Лучше хоть какие-то тесты, чем совсем без них. В идеале нужно предъявлять процент покрытия кода тестами.
%           \item Лучше  сделать \textsc{CI}, а также \textsc{CD}, если оно уместно в Вашем проекте.
%           \item Не стоит демонстрировать на защите, что Вам даже не пришло в голову напустить на код линтеры и т.п.
%         \end{enumerate}
%   \item Если ваша реализация по сути является прохождением стандартного туториала,
%   например, по отделению картинок кружек от котиков с помощью машинного обучения, то необходимо срочно сообщить об этом куратору на мат-мехе,
%   иначе Государственная Экзаменацион\-ная Комиссия \enquote{порвёт Вас как Тузик грелку}, поставит \enquote{единицу},
%   а все остальные Ваши сокурсники получат оценку выше. (Это не шутка, а реальная история 2020 года.)
% \end{enumerate}

% \noindent Если Вам предстоит защищать учебную практику, а эти рекомендации видятся как более подходящие для защиты ВКР, то ... отмаза не засчиты\-вается, сразу учитесь делать нормально.
